<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carti√±os - Gestor de Gastos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f0f23 0%, #1a0a2e 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        .card-neon {
            background: rgba(15, 15, 35, 0.8);
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
        }

        .card-neon::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #FF006E, #8338EC, #3A86FF, #FFBE0B);
            border-radius: inherit;
            z-index: -1;
            opacity: 0.5;
        }

        .btn-neon {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .btn-neon:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 20px rgba(131, 56, 236, 0.6);
        }

        .input-neon {
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(131, 56, 236, 0.5);
            transition: all 0.3s ease;
        }

        .input-neon:focus {
            outline: none;
            border-color: #8338EC;
            box-shadow: 0 0 15px rgba(131, 56, 236, 0.3);
        }

        .stat-card {
            background: linear-gradient(135deg, rgba(131, 56, 236, 0.2), rgba(255, 0, 110, 0.1));
            backdrop-filter: blur(10px);
        }

        .delete-btn {
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .gasto-item:hover .delete-btn {
            opacity: 1;
        }

        @keyframes pulse-glow {
            0%, 100% {
                box-shadow: 0 0 10px rgba(131, 56, 236, 0.5);
            }
            50% {
                box-shadow: 0 0 20px rgba(255, 0, 110, 0.7);
            }
        }

        .pulse-animation {
            animation: pulse-glow 2s infinite;
        }
    </style>
</head>
<body class="text-white">
    <div id="app" class="min-h-screen p-4 md:p-8"></div>

    <script>
        // Estado global de la aplicaci√≥n
        let state = {
            sueldo: localStorage.getItem('sueldo') || '',
            diaCobro: localStorage.getItem('diaCobro') || '',
            gastosFijos: JSON.parse(localStorage.getItem('gastosFijos') || '[]'),
            gastos: JSON.parse(localStorage.getItem('gastos') || '[]'),
            ingresos: JSON.parse(localStorage.getItem('ingresos') || '[]'),
            ajustes: JSON.parse(localStorage.getItem('ajustes') || '[]'),
            nuevoGastoFijo: { nombre: '', monto: '' },
            categorias: JSON.parse(localStorage.getItem('categorias') || '["Alimentaci√≥n", "Transporte", "Entretenimiento", "Salud", "Hogar", "Ropa", "Otros"]'),
            nuevoGasto: { descripcion: '', monto: '', categoria: '' },
            nuevoIngreso: { descripcion: '', monto: '' },
            nuevoAjuste: { descripcion: '', monto: '', tipo: 'positivo' },
            objetivosAhorro: JSON.parse(localStorage.getItem('objetivosAhorro') || '[]'),
            nuevoObjetivo: { nombre: '', metaMonto: '', fechaLimite: '', montoAhorrado: '0' },
            nuevaCategoria: '',
            perfiles: JSON.parse(localStorage.getItem('perfiles') || '[{"id": 1, "nombre": "Personal", "activo": true}]'),
            perfilActivo: 1,
            nuevoPerfil: '',
            vista: 'principal',
            mesSeleccionado: new Date(),
            alertasConfig: JSON.parse(localStorage.getItem('alertasConfig') || '{"diasParaCobro": 3, "gastoMaximoDia": 100, "recordatoriosGastosFijos": true}'),
            alertasMostradas: [],
            cuentas: JSON.parse(localStorage.getItem('cuentas') || '[{"id": 1, "nombre": "Cuenta Principal", "tipo": "banco", "saldoInicial": 0}]'),
            nuevaCuenta: { nombre: '', tipo: 'banco', saldoInicial: '0' }
        };

        // Inicializar categor√≠a por defecto
        if (!state.nuevoGasto.categoria) {
            state.nuevoGasto.categoria = state.categorias[0] || 'Otros';
        }

        // Inicializar perfil activo
        const perfilesGuardados = JSON.parse(localStorage.getItem('perfiles') || '[{"id": 1, "nombre": "Personal", "activo": true}]');
        state.perfilActivo = perfilesGuardados.find(p => p.activo)?.id || 1;

        // Funci√≥n para guardar en localStorage
        function guardarEstado() {
            localStorage.setItem('sueldo', state.sueldo);
            localStorage.setItem('diaCobro', state.diaCobro);
            localStorage.setItem('gastosFijos', JSON.stringify(state.gastosFijos));
            localStorage.setItem('gastos', JSON.stringify(state.gastos));
            localStorage.setItem('ingresos', JSON.stringify(state.ingresos));
            localStorage.setItem('ajustes', JSON.stringify(state.ajustes));
            localStorage.setItem('objetivosAhorro', JSON.stringify(state.objetivosAhorro));
            localStorage.setItem('categorias', JSON.stringify(state.categorias));
            localStorage.setItem('perfiles', JSON.stringify(state.perfiles));
            localStorage.setItem('alertasConfig', JSON.stringify(state.alertasConfig));
            localStorage.setItem('cuentas', JSON.stringify(state.cuentas));
        }

        // Funci√≥n para obtener color por categor√≠a
        function obtenerColorCategoria(categoria) {
            const coloresPredefinidos = {
                'Alimentaci√≥n': '#FF006E',
                'Transporte': '#8338EC',
                'Entretenimiento': '#FFBE0B',
                'Salud': '#FB5607',
                'Hogar': '#3A86FF',
                'Ropa': '#FF006E',
                'Otros': '#00F5FF'
            };
            
            if (coloresPredefinidos[categoria]) return coloresPredefinidos[categoria];
            
            let hash = 0;
            for (let i = 0; i < categoria.length; i++) {
                hash = categoria.charCodeAt(i) + ((hash << 5) - hash);
            }
            const colores = ['#FF006E', '#8338EC', '#FFBE0B', '#FB5607', '#3A86FF', '#00F5FF', '#10b981', '#f59e0b'];
            return colores[Math.abs(hash) % colores.length];
        }

        // Funci√≥n para verificar alertas
        function verificarAlertas() {
            const nuevasAlertas = [];
            const hoy = new Date();
            const stats = calcularEstadisticas();
            const gastosPerfil = obtenerGastosPerfil();

            if (state.alertasConfig.diasParaCobro > 0 && stats.diasRestantes <= state.alertasConfig.diasParaCobro) {
                nuevasAlertas.push({
                    tipo: 'info',
                    mensaje: `‚è∞ Te quedan ${stats.diasRestantes} d√≠as para cobrar`,
                    id: 'dias-cobro'
                });
            }

            if (state.alertasConfig.gastoMaximoDia > 0) {
                const gastosHoy = gastosPerfil.filter(g => {
                    const fechaGasto = new Date(g.fecha);
                    return fechaGasto.toDateString() === hoy.toDateString();
                });
                const totalHoy = gastosHoy.reduce((sum, g) => sum + parseFloat(g.monto), 0);
                
                if (totalHoy > state.alertasConfig.gastoMaximoDia) {
                    nuevasAlertas.push({
                        tipo: 'warning',
                        mensaje: `‚ö†Ô∏è Has gastado ${totalHoy.toFixed(2)}‚Ç¨ hoy (l√≠mite: ${state.alertasConfig.gastoMaximoDia}‚Ç¨)`,
                        id: 'gasto-dia'
                    });
                }
            }

            state.alertasMostradas = nuevasAlertas;
        }

        // Funci√≥n para obtener gastos del perfil activo
        function obtenerGastosPerfil() {
            return state.gastos.filter(g => g.perfilId === state.perfilActivo);
        }

        // Funci√≥n para obtener ingresos del perfil activo
        function obtenerIngresosPerfil() {
            return state.ingresos.filter(i => i.perfilId === state.perfilActivo);
        }

        // Funci√≥n para obtener ajustes del perfil activo
        function obtenerAjustesPerfil() {
            return state.ajustes.filter(a => a.perfilId === state.perfilActivo);
        }

        // Funci√≥n para calcular estad√≠sticas
        function calcularEstadisticas() {
            const hoy = new Date();
            const diaActual = hoy.getDate();
            const mesActual = hoy.getMonth();
            const a√±oActual = hoy.getFullYear();
            
            let proximoCobro = new Date(a√±oActual, mesActual, parseInt(state.diaCobro || 1));
            if (diaActual >= parseInt(state.diaCobro || 1)) {
                proximoCobro = new Date(a√±oActual, mesActual + 1, parseInt(state.diaCobro || 1));
            }
            
            const diasRestantes = Math.ceil((proximoCobro - hoy) / (1000 * 60 * 60 * 24));
            
            const totalGastosFijos = state.gastosFijos.reduce((sum, gasto) => sum + parseFloat(gasto.monto || 0), 0);
            
            const gastosPerfil = obtenerGastosPerfil();
            const gastosDelMes = gastosPerfil.filter(gasto => {
                const fechaGasto = new Date(gasto.fecha);
                return fechaGasto.getMonth() === mesActual && fechaGasto.getFullYear() === a√±oActual;
            });
            
            const totalGastosVariables = gastosDelMes.reduce((sum, gasto) => sum + parseFloat(gasto.monto || 0), 0);
            
            const ingresosPerfil = obtenerIngresosPerfil();
            const ingresosDelMes = ingresosPerfil.filter(ingreso => {
                const fechaIngreso = new Date(ingreso.fecha);
                return fechaIngreso.getMonth() === mesActual && fechaIngreso.getFullYear() === a√±oActual;
            });
            const totalIngresos = ingresosDelMes.reduce((sum, ingreso) => sum + parseFloat(ingreso.monto || 0), 0);
            
            const ajustesPerfil = obtenerAjustesPerfil();
            const ajustesDelMes = ajustesPerfil.filter(ajuste => {
                const fechaAjuste = new Date(ajuste.fecha);
                return fechaAjuste.getMonth() === mesActual && fechaAjuste.getFullYear() === a√±oActual;
            });
            const totalAjustes = ajustesDelMes.reduce((sum, ajuste) => {
                const monto = parseFloat(ajuste.monto || 0);
                return sum + (ajuste.tipo === 'positivo' ? monto : -monto);
            }, 0);
            
            let ahorroDiarioNecesario = 0;
            state.objetivosAhorro.forEach(objetivo => {
                if (objetivo.activo !== false) {
                    const fechaLimite = new Date(objetivo.fechaLimite);
                    const diasParaObjetivo = Math.ceil((fechaLimite - hoy) / (1000 * 60 * 60 * 24));
                    const montoRestante = parseFloat(objetivo.metaMonto) - parseFloat(objetivo.montoAhorrado || 0);
                    
                    if (diasParaObjetivo > 0 && montoRestante > 0) {
                        ahorroDiarioNecesario += montoRestante / diasParaObjetivo;
                    }
                }
            });
            
            const disponibleTotal = parseFloat(state.sueldo || 0) + totalIngresos + totalAjustes - totalGastosFijos - totalGastosVariables;
            const gastoPorDiaRestante = diasRestantes > 0 ? (disponibleTotal - (ahorroDiarioNecesario * diasRestantes)) / diasRestantes : 0;
            
            return {
                diasRestantes,
                totalGastosFijos,
                totalGastosVariables,
                totalIngresos,
                totalAjustes,
                disponibleTotal,
                gastoPorDiaRestante: Math.max(0, gastoPorDiaRestante),
                ahorroDiarioNecesario,
                totalGastos: totalGastosFijos + totalGastosVariables,
                ingresoTotal: parseFloat(state.sueldo || 0) + totalIngresos
            };
        }

        // Funci√≥n para agregar gasto fijo
        function agregarGastoFijo() {
            if (state.nuevoGastoFijo.nombre && state.nuevoGastoFijo.monto) {
                state.gastosFijos.push({
                    ...state.nuevoGastoFijo,
                    id: Date.now()
                });
                state.nuevoGastoFijo = { nombre: '', monto: '' };
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar gasto fijo
        function eliminarGastoFijo(id) {
            state.gastosFijos = state.gastosFijos.filter(g => g.id !== id);
            guardarEstado();
            render();
        }

        // Funci√≥n para agregar gasto
        function agregarGasto() {
            if (state.nuevoGasto.descripcion && state.nuevoGasto.monto) {
                state.gastos.push({
                    ...state.nuevoGasto,
                    fecha: new Date().toISOString(),
                    id: Date.now(),
                    perfilId: state.perfilActivo
                });
                state.nuevoGasto = { descripcion: '', monto: '', categoria: state.categorias[0] || 'Otros' };
                guardarEstado();
                verificarAlertas();
                render();
            }
        }

        // Funci√≥n para eliminar gasto
        function eliminarGasto(id) {
            state.gastos = state.gastos.filter(g => g.id !== id);
            guardarEstado();
            render();
        }

        // Funci√≥n para agregar ingreso
        function agregarIngreso() {
            if (state.nuevoIngreso.descripcion && state.nuevoIngreso.monto) {
                state.ingresos.push({
                    ...state.nuevoIngreso,
                    fecha: new Date().toISOString(),
                    id: Date.now(),
                    perfilId: state.perfilActivo
                });
                state.nuevoIngreso = { descripcion: '', monto: '' };
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar ingreso
        function eliminarIngreso(id) {
            state.ingresos = state.ingresos.filter(i => i.id !== id);
            guardarEstado();
            render();
        }

        // Funci√≥n para agregar ajuste
        function agregarAjuste() {
            if (state.nuevoAjuste.descripcion && state.nuevoAjuste.monto) {
                state.ajustes.push({
                    ...state.nuevoAjuste,
                    fecha: new Date().toISOString(),
                    id: Date.now(),
                    perfilId: state.perfilActivo
                });
                state.nuevoAjuste = { descripcion: '', monto: '', tipo: 'positivo' };
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar ajuste
        function eliminarAjuste(id) {
            state.ajustes = state.ajustes.filter(a => a.id !== id);
            guardarEstado();
            render();
        }

        // Funci√≥n para agregar objetivo de ahorro
        function agregarObjetivo() {
            if (state.nuevoObjetivo.nombre && state.nuevoObjetivo.metaMonto && state.nuevoObjetivo.fechaLimite) {
                state.objetivosAhorro.push({
                    ...state.nuevoObjetivo,
                    id: Date.now(),
                    activo: true
                });
                state.nuevoObjetivo = { nombre: '', metaMonto: '', fechaLimite: '', montoAhorrado: '0' };
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar objetivo
        function eliminarObjetivo(id) {
            state.objetivosAhorro = state.objetivosAhorro.filter(o => o.id !== id);
            guardarEstado();
            render();
        }

        // Funci√≥n para agregar categor√≠a
        function agregarCategoria() {
            if (state.nuevaCategoria && !state.categorias.includes(state.nuevaCategoria)) {
                state.categorias.push(state.nuevaCategoria);
                state.nuevaCategoria = '';
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar categor√≠a
        function eliminarCategoria(categoria) {
            if (state.categorias.length > 1) {
                state.categorias = state.categorias.filter(c => c !== categoria);
                if (state.nuevoGasto.categoria === categoria) {
                    state.nuevoGasto.categoria = state.categorias[0] || 'Otros';
                }
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para agregar perfil
        function agregarPerfil() {
            if (state.nuevoPerfil) {
                const nuevoId = Math.max(...state.perfiles.map(p => p.id), 0) + 1;
                state.perfiles.push({
                    id: nuevoId,
                    nombre: state.nuevoPerfil,
                    activo: false
                });
                state.nuevoPerfil = '';
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar perfil
        function eliminarPerfil(id) {
            if (state.perfiles.length > 1 && id !== state.perfilActivo) {
                state.perfiles = state.perfiles.filter(p => p.id !== id);
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para cambiar perfil activo
        function cambiarPerfilActivo(id) {
            state.perfiles = state.perfiles.map(p => ({
                ...p,
                activo: p.id === id
            }));
            state.perfilActivo = id;
            guardarEstado();
            render();
        }

        // Funci√≥n para agregar cuenta
        function agregarCuenta() {
            if (state.nuevaCuenta.nombre) {
                const nuevoId = Math.max(...state.cuentas.map(c => c.id), 0) + 1;
                state.cuentas.push({
                    ...state.nuevaCuenta,
                    id: nuevoId,
                    saldoInicial: parseFloat(state.nuevaCuenta.saldoInicial || 0)
                });
                state.nuevaCuenta = { nombre: '', tipo: 'banco', saldoInicial: '0' };
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para eliminar cuenta
        function eliminarCuenta(id) {
            if (state.cuentas.length > 1) {
                state.cuentas = state.cuentas.filter(c => c.id !== id);
                guardarEstado();
                render();
            }
        }

        // Funci√≥n para obtener datos del gr√°fico por mes
        function obtenerDatosGraficoPorMes(fecha) {
            const mes = fecha.getMonth();
            const a√±o = fecha.getFullYear();
            const gastosPerfil = obtenerGastosPerfil();
            
            const gastosDelMes = gastosPerfil.filter(gasto => {
                const fechaGasto = new Date(gasto.fecha);
                return fechaGasto.getMonth() === mes && fechaGasto.getFullYear() === a√±o;
            });
            
            const gastosPorCategoria = {};
            gastosDelMes.forEach(gasto => {
                const categoria = gasto.categoria || 'Otros';
                gastosPorCategoria[categoria] = (gastosPorCategoria[categoria] || 0) + parseFloat(gasto.monto);
            });
            
            return Object.entries(gastosPorCategoria).map(([nombre, valor]) => ({
                nombre,
                valor
            }));
        }

        // Funci√≥n para calcular estad√≠sticas de un mes espec√≠fico
        function calcularEstadisticasMes(fecha) {
            const mes = fecha.getMonth();
            const a√±o = fecha.getFullYear();
            const gastosPerfil = obtenerGastosPerfil();
            const ingresosPerfil = obtenerIngresosPerfil();
            const ajustesPerfil = obtenerAjustesPerfil();
            
            const gastosDelMes = gastosPerfil.filter(g => {
                const fechaGasto = new Date(g.fecha);
                return fechaGasto.getMonth() === mes && fechaGasto.getFullYear() === a√±o;
            });
            
            const ingresosDelMes = ingresosPerfil.filter(i => {
                const fechaIngreso = new Date(i.fecha);
                return fechaIngreso.getMonth() === mes && fechaIngreso.getFullYear() === a√±o;
            });
            
            const ajustesDelMes = ajustesPerfil.filter(a => {
                const fechaAjuste = new Date(a.fecha);
                return fechaAjuste.getMonth() === mes && fechaAjuste.getFullYear() === a√±o;
            });
            
            const totalGastosFijos = state.gastosFijos.reduce((sum, g) => sum + parseFloat(g.monto || 0), 0);
            const totalGastosVariables = gastosDelMes.reduce((sum, g) => sum + parseFloat(g.monto || 0), 0);
            const totalIngresos = ingresosDelMes.reduce((sum, i) => sum + parseFloat(i.monto || 0), 0);
            const totalAjustes = ajustesDelMes.reduce((sum, a) => {
                const monto = parseFloat(a.monto || 0);
                return sum + (a.tipo === 'positivo' ? monto : -monto);
            }, 0);
            
            const totalGastos = totalGastosFijos + totalGastosVariables;
            const balance = parseFloat(state.sueldo || 0) + totalIngresos + totalAjustes - totalGastos;
            
            return {
                totalGastos,
                totalIngresos,
                balance,
                totalGastosFijos,
                totalGastosVariables
            };
        }

        // Funci√≥n para obtener estad√≠sticas del dashboard
        function obtenerEstadisticasDashboard() {
            const datosBarras = [];
            for (let i = 2; i >= 0; i--) {
                const fecha = new Date();
                fecha.setMonth(fecha.getMonth() - i);
                const stats = calcularEstadisticasMes(fecha);
                const nombreMes = fecha.toLocaleDateString('es-ES', { month: 'short' });
                
                datosBarras.push({
                    mes: nombreMes,
                    ingresos: parseFloat(state.sueldo || 0) + stats.totalIngresos,
                    gastos: stats.totalGastos
                });
            }
            
            return { datosBarras };
        }

        // Funci√≥n para cambiar vista
        function cambiarVista(nuevaVista) {
            state.vista = nuevaVista;
            render();
        }

        // Funci√≥n principal de renderizado
        function render() {
            const app = document.getElementById('app');
            const stats = calcularEstadisticas();
            const gastosPerfil = obtenerGastosPerfil();
            const ingresosPerfil = obtenerIngresosPerfil();
            const ajustesPerfil = obtenerAjustesPerfil();
            const perfilNombre = state.perfiles.find(p => p.id === state.perfilActivo)?.nombre || 'Personal';

            verificarAlertas();

            let html = `
                <div class="max-w-7xl mx-auto">
                    <!-- Header -->
                    <div class="card-neon rounded-3xl p-6 mb-8 text-center">
                        <h1 class="text-5xl font-black mb-2" style="background: linear-gradient(45deg, #FF006E, #8338EC, #3A86FF, #FFBE0B); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                            üí∞ Carti√±os
                        </h1>
                        <p class="text-gray-400 text-lg">Gesti√≥n Inteligente de Gastos - Perfil: ${perfilNombre}</p>
                    </div>

                    <!-- Alertas -->
                    ${state.alertasMostradas.length > 0 ? `
                        <div class="mb-6 space-y-3">
                            ${state.alertasMostradas.map(alerta => `
                                <div class="card-neon rounded-xl p-4 ${alerta.tipo === 'warning' ? 'border-yellow-500' : 'border-blue-500'}">
                                    <p class="text-white">${alerta.mensaje}</p>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <!-- Navegaci√≥n -->
                    <div class="flex flex-wrap gap-2 mb-6">
                        <button onclick="cambiarVista('principal')" class="btn-neon px-6 py-3 rounded-xl font-bold transition-all ${state.vista === 'principal' ? 'bg-purple-600' : 'bg-purple-600/50'}">
                            üè† Principal
                        </button>
                        <button onclick="cambiarVista('estadisticas')" class="btn-neon px-6 py-3 rounded-xl font-bold transition-all ${state.vista === 'estadisticas' ? 'bg-purple-600' : 'bg-purple-600/50'}">
                            üìä Estad√≠sticas
                        </button>
                        <button onclick="cambiarVista('objetivos')" class="btn-neon px-6 py-3 rounded-xl font-bold transition-all ${state.vista === 'objetivos' ? 'bg-purple-600' : 'bg-purple-600/50'}">
                            üéØ Objetivos
                        </button>
                        <button onclick="cambiarVista('categorias')" class="btn-neon px-6 py-3 rounded-xl font-bold transition-all ${state.vista === 'categorias' ? 'bg-purple-600' : 'bg-purple-600/50'}">
                            üìÅ Categor√≠as
                        </button>
                        <button onclick="cambiarVista('perfiles')" class="btn-neon px-6 py-3 rounded-xl font-bold transition-all ${state.vista === 'perfiles' ? 'bg-purple-600' : 'bg-purple-600/50'}">
                            üë§ Perfiles
                        </button>
                        <button onclick="cambiarVista('configuracion')" class="btn-neon px-6 py-3 rounded-xl font-bold transition-all ${state.vista === 'configuracion' ? 'bg-purple-600' : 'bg-purple-600/50'}">
                            ‚öôÔ∏è Config
                        </button>
                    </div>
            `;

            // Vista Principal
            if (state.vista === 'principal') {
                html += `
                    <!-- Estad√≠sticas Principales -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="stat-card rounded-2xl p-6 border-2 border-purple-500/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400 text-sm">Disponible Total</span>
                                <span class="text-2xl">üí∞</span>
                            </div>
                            <p class="text-4xl font-black text-green-400">${stats.disponibleTotal.toFixed(2)}‚Ç¨</p>
                        </div>

                        <div class="stat-card rounded-2xl p-6 border-2 border-pink-500/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400 text-sm">Gasto por D√≠a</span>
                                <span class="text-2xl">üìÖ</span>
                            </div>
                            <p class="text-4xl font-black text-yellow-400">${stats.gastoPorDiaRestante.toFixed(2)}‚Ç¨</p>
                        </div>

                        <div class="stat-card rounded-2xl p-6 border-2 border-blue-500/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400 text-sm">D√≠as Restantes</span>
                                <span class="text-2xl">‚è∞</span>
                            </div>
                            <p class="text-4xl font-black text-blue-400">${stats.diasRestantes}</p>
                        </div>

                        <div class="stat-card rounded-2xl p-6 border-2 border-red-500/30">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-gray-400 text-sm">Gastos del Mes</span>
                                <span class="text-2xl">üí∏</span>
                            </div>
                            <p class="text-4xl font-black text-red-400">${stats.totalGastos.toFixed(2)}‚Ç¨</p>
                        </div>
                    </div>

                    <!-- Configuraci√≥n B√°sica -->
                    <div class="card-neon rounded-2xl p-6 mb-8">
                        <h2 class="text-2xl font-bold mb-6 text-white">‚öôÔ∏è Configuraci√≥n B√°sica</h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="text-gray-300 block mb-2 font-semibold">üíµ Sueldo Mensual</label>
                                <input 
                                    type="number" 
                                    class="input-neon w-full px-4 py-3 rounded-xl text-white"
                                    value="${state.sueldo}"
                                    oninput="state.sueldo = this.value; guardarEstado(); render();"
                                    placeholder="Ej: 2000"
                                />
                            </div>
                            <div>
                                <label class="text-gray-300 block mb-2 font-semibold">üìÖ D√≠a de Cobro</label>
                                <input 
                                    type="number" 
                                    min="1" 
                                    max="31"
                                    class="input-neon w-full px-4 py-3 rounded-xl text-white"
                                    value="${state.diaCobro}"
                                    oninput="state.diaCobro = this.value; guardarEstado(); render();"
                                    placeholder="Ej: 1"
                                />
                            </div>
                        </div>
                    </div>

                    <!-- Gastos Fijos -->
                    <div class="card-neon rounded-2xl p-6 mb-8">
                        <h2 class="text-2xl font-bold mb-6 text-white">üè† Gastos Fijos Mensuales</h2>
                        
                        ${state.gastosFijos.length > 0 ? `
                            <div class="space-y-3 mb-6">
                                ${state.gastosFijos.map(gasto => `
                                    <div class="gasto-item flex justify-between items-center bg-black/30 rounded-xl p-4">
                                        <div class="flex-1">
                                            <p class="text-white font-semibold">${gasto.nombre}</p>
                                        </div>
                                        <div class="flex items-center gap-4">
                                            <span class="text-red-400 font-bold text-lg">${parseFloat(gasto.monto).toFixed(2)}‚Ç¨</span>
                                            <button 
                                                onclick="eliminarGastoFijo(${gasto.id})"
                                                class="delete-btn text-red-500 hover:text-red-400 transition-colors"
                                            >
                                                ‚ùå
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                                <div class="border-t border-purple-500/30 pt-3 flex justify-between items-center">
                                    <span class="text-gray-300 font-bold">Total Gastos Fijos:</span>
                                    <span class="text-red-400 font-bold text-xl">${stats.totalGastosFijos.toFixed(2)}‚Ç¨</span>
                                </div>
                            </div>
                        ` : '<p class="text-gray-400 text-center py-4 mb-6">No hay gastos fijos registrados</p>'}

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input 
                                type="text"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Nombre del gasto"
                                value="${state.nuevoGastoFijo.nombre}"
                                oninput="state.nuevoGastoFijo.nombre = this.value"
                            />
                            <input 
                                type="number"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Monto"
                                value="${state.nuevoGastoFijo.monto}"
                                oninput="state.nuevoGastoFijo.monto = this.value"
                            />
                            <button 
                                onclick="agregarGastoFijo()"
                                class="btn-neon bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-3 rounded-xl font-bold"
                            >
                                ‚ûï Agregar Gasto Fijo
                            </button>
                        </div>
                    </div>

                    <!-- Gastos Variables -->
                    <div class="card-neon rounded-2xl p-6 mb-8">
                        <h2 class="text-2xl font-bold mb-6 text-white">üí∏ Gastos Variables</h2>
                        
                        ${gastosPerfil.length > 0 ? `
                            <div class="space-y-3 mb-6">
                                ${gastosPerfil.slice().reverse().slice(0, 10).map(gasto => {
                                    const fecha = new Date(gasto.fecha);
                                    return `
                                        <div class="gasto-item flex justify-between items-center bg-black/30 rounded-xl p-4">
                                            <div class="flex-1">
                                                <div class="flex items-center gap-3">
                                                    <div 
                                                        class="w-3 h-3 rounded-full"
                                                        style="background-color: ${obtenerColorCategoria(gasto.categoria || 'Otros')}"
                                                    ></div>
                                                    <p class="text-white font-semibold">${gasto.descripcion}</p>
                                                </div>
                                                <p class="text-gray-400 text-sm mt-1">${fecha.toLocaleDateString('es-ES')} - ${gasto.categoria || 'Otros'}</p>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                <span class="text-red-400 font-bold text-lg">${parseFloat(gasto.monto).toFixed(2)}‚Ç¨</span>
                                                <button 
                                                    onclick="eliminarGasto(${gasto.id})"
                                                    class="delete-btn text-red-500 hover:text-red-400 transition-colors"
                                                >
                                                    ‚ùå
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                                <div class="border-t border-purple-500/30 pt-3 flex justify-between items-center">
                                    <span class="text-gray-300 font-bold">Total Gastos Variables:</span>
                                    <span class="text-red-400 font-bold text-xl">${stats.totalGastosVariables.toFixed(2)}‚Ç¨</span>
                                </div>
                            </div>
                        ` : '<p class="text-gray-400 text-center py-4 mb-6">No hay gastos registrados este mes</p>'}

                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input 
                                type="text"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Descripci√≥n"
                                value="${state.nuevoGasto.descripcion}"
                                oninput="state.nuevoGasto.descripcion = this.value"
                            />
                            <input 
                                type="number"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Monto"
                                value="${state.nuevoGasto.monto}"
                                oninput="state.nuevoGasto.monto = this.value"
                            />
                            <select 
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                onchange="state.nuevoGasto.categoria = this.value"
                            >
                                ${state.categorias.map(cat => `
                                    <option value="${cat}" ${state.nuevoGasto.categoria === cat ? 'selected' : ''}>${cat}</option>
                                `).join('')}
                            </select>
                            <button 
                                onclick="agregarGasto()"
                                class="btn-neon bg-gradient-to-r from-pink-600 to-red-600 px-6 py-3 rounded-xl font-bold"
                            >
                                ‚ûï Agregar Gasto
                            </button>
                        </div>
                    </div>

                    <!-- Ingresos Puntuales -->
                    <div class="card-neon rounded-2xl p-6 mb-8">
                        <h2 class="text-2xl font-bold mb-6 text-white">üíµ Ingresos Puntuales</h2>
                        
                        ${ingresosPerfil.length > 0 ? `
                            <div class="space-y-3 mb-6">
                                ${ingresosPerfil.slice().reverse().map(ingreso => {
                                    const fecha = new Date(ingreso.fecha);
                                    return `
                                        <div class="gasto-item flex justify-between items-center bg-black/30 rounded-xl p-4">
                                            <div class="flex-1">
                                                <p class="text-white font-semibold">${ingreso.descripcion}</p>
                                                <p class="text-gray-400 text-sm mt-1">${fecha.toLocaleDateString('es-ES')}</p>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                <span class="text-green-400 font-bold text-lg">+${parseFloat(ingreso.monto).toFixed(2)}‚Ç¨</span>
                                                <button 
                                                    onclick="eliminarIngreso(${ingreso.id})"
                                                    class="delete-btn text-red-500 hover:text-red-400 transition-colors"
                                                >
                                                    ‚ùå
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : '<p class="text-gray-400 text-center py-4 mb-6">No hay ingresos puntuales registrados</p>'}

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <input 
                                type="text"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Descripci√≥n"
                                value="${state.nuevoIngreso.descripcion}"
                                oninput="state.nuevoIngreso.descripcion = this.value"
                            />
                            <input 
                                type="number"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Monto"
                                value="${state.nuevoIngreso.monto}"
                                oninput="state.nuevoIngreso.monto = this.value"
                            />
                            <button 
                                onclick="agregarIngreso()"
                                class="btn-neon bg-gradient-to-r from-green-600 to-emerald-600 px-6 py-3 rounded-xl font-bold"
                            >
                                ‚ûï Agregar Ingreso
                            </button>
                        </div>
                    </div>

                    <!-- Ajustes -->
                    <div class="card-neon rounded-2xl p-6">
                        <h2 class="text-2xl font-bold mb-6 text-white">‚öñÔ∏è Ajustes</h2>
                        
                        ${ajustesPerfil.length > 0 ? `
                            <div class="space-y-3 mb-6">
                                ${ajustesPerfil.slice().reverse().map(ajuste => {
                                    const fecha = new Date(ajuste.fecha);
                                    return `
                                        <div class="gasto-item flex justify-between items-center bg-black/30 rounded-xl p-4">
                                            <div class="flex-1">
                                                <p class="text-white font-semibold">${ajuste.descripcion}</p>
                                                <p class="text-gray-400 text-sm mt-1">${fecha.toLocaleDateString('es-ES')}</p>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                <span class="font-bold text-lg ${ajuste.tipo === 'positivo' ? 'text-green-400' : 'text-red-400'}">
                                                    ${ajuste.tipo === 'positivo' ? '+' : '-'}${parseFloat(ajuste.monto).toFixed(2)}‚Ç¨
                                                </span>
                                                <button 
                                                    onclick="eliminarAjuste(${ajuste.id})"
                                                    class="delete-btn text-red-500 hover:text-red-400 transition-colors"
                                                >
                                                    ‚ùå
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : '<p class="text-gray-400 text-center py-4 mb-6">No hay ajustes registrados</p>'}

                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input 
                                type="text"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Descripci√≥n"
                                value="${state.nuevoAjuste.descripcion}"
                                oninput="state.nuevoAjuste.descripcion = this.value"
                            />
                            <input 
                                type="number"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Monto"
                                value="${state.nuevoAjuste.monto}"
                                oninput="state.nuevoAjuste.monto = this.value"
                            />
                            <select 
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                onchange="state.nuevoAjuste.tipo = this.value"
                            >
                                <option value="positivo" ${state.nuevoAjuste.tipo === 'positivo' ? 'selected' : ''}>‚ûï Positivo</option>
                                <option value="negativo" ${state.nuevoAjuste.tipo === 'negativo' ? 'selected' : ''}>‚ûñ Negativo</option>
                            </select>
                            <button 
                                onclick="agregarAjuste()"
                                class="btn-neon bg-gradient-to-r from-blue-600 to-cyan-600 px-6 py-3 rounded-xl font-bold"
                            >
                                ‚ûï Agregar Ajuste
                            </button>
                        </div>
                    </div>
                `;
            }
            // Vista de Estad√≠sticas
            else if (state.vista === 'estadisticas') {
                const datosGrafico = obtenerDatosGraficoPorMes(state.mesSeleccionado);
                const dashboard = obtenerEstadisticasDashboard();
                
                html += `
                    <div class="space-y-8">
                        <!-- Selector de Mes -->
                        <div class="card-neon rounded-2xl p-6">
                            <h2 class="text-2xl font-bold mb-4 text-white">üìÖ Seleccionar Mes</h2>
                            <input 
                                type="month"
                                class="input-neon px-4 py-3 rounded-xl text-white w-full"
                                value="${state.mesSeleccionado.toISOString().slice(0, 7)}"
                                onchange="state.mesSeleccionado = new Date(this.value + '-01'); render();"
                            />
                        </div>

                        <!-- Gr√°fico de Pastel -->
                        <div class="card-neon rounded-2xl p-6">
                            <h2 class="text-2xl font-bold mb-6 text-white">üìä Distribuci√≥n de Gastos por Categor√≠a</h2>
                            ${datosGrafico.length > 0 ? `
                                <canvas id="pieChart" width="400" height="400"></canvas>
                                <div class="mt-6 space-y-3">
                                    <h3 class="text-lg font-bold text-white mb-3">Desglose por Categor√≠a</h3>
                                    ${datosGrafico.map(dato => {
                                        const total = datosGrafico.reduce((sum, d) => sum + d.valor, 0);
                                        const porcentaje = (dato.valor / total * 100).toFixed(1);
                                        return `
                                            <div class="flex justify-between items-center bg-black/30 rounded-xl p-3">
                                                <div class="flex items-center gap-3 flex-1">
                                                    <div 
                                                        class="w-4 h-4 rounded"
                                                        style="background-color: ${obtenerColorCategoria(dato.nombre)}"
                                                    ></div>
                                                    <span class="text-white font-semibold">${dato.nombre}</span>
                                                    <span class="text-gray-400 text-sm">(${porcentaje}%)</span>
                                                </div>
                                                <span class="text-white font-bold">${dato.valor.toFixed(2)}‚Ç¨</span>
                                            </div>
                                        `;
                                    }).join('')}
                                    <div class="border-t border-purple-500/30 pt-3 flex justify-between items-center">
                                        <span class="text-gray-300 font-bold">Total Gastos:</span>
                                        <span class="text-red-400 font-bold text-xl">${datosGrafico.reduce((sum, d) => sum + d.valor, 0).toFixed(2)}‚Ç¨</span>
                                    </div>
                                </div>
                            ` : '<p class="text-gray-400 text-center py-8">No hay datos suficientes para mostrar el gr√°fico de este mes</p>'}
                        </div>

                        <!-- Comparaci√≥n de √öltimos 3 Meses -->
                        <div class="card-neon rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">üìà √öltimos 3 Meses</h3>
                            <div class="space-y-3">
                                ${[0, 1, 2].map(offset => {
                                    const fecha = new Date();
                                    fecha.setMonth(fecha.getMonth() - offset);
                                    const stats = calcularEstadisticasMes(fecha);
                                    const nombreMes = fecha.toLocaleDateString('es-ES', { month: 'long', year: 'numeric' });
                                    
                                    return `
                                        <div class="bg-black/30 rounded-xl p-4">
                                            <div class="flex justify-between items-center mb-2">
                                                <span class="text-white font-semibold capitalize">${nombreMes}</span>
                                                <span class="font-bold ${stats.balance >= 0 ? 'text-green-400' : 'text-red-400'}">
                                                    ${stats.balance.toFixed(2)}‚Ç¨
                                                </span>
                                            </div>
                                            <div class="grid grid-cols-2 gap-2 text-sm">
                                                <div class="text-gray-400">
                                                    Ingresos: <span class="text-green-400">+${(parseFloat(state.sueldo || 0) + stats.totalIngresos).toFixed(0)}‚Ç¨</span>
                                                </div>
                                                <div class="text-gray-400">
                                                    Gastos: <span class="text-red-400">-${stats.totalGastos.toFixed(0)}‚Ç¨</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>

                        <!-- Gr√°fico de Barras Comparativo -->
                        <div class="card-neon rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-white mb-4">üìä Comparativa Mensual (Barras)</h3>
                            <canvas id="barChart" width="400" height="300"></canvas>
                        </div>
                    </div>
                `;
            }
            // Vista de Objetivos
            else if (state.vista === 'objetivos') {
                html += `
                    <div class="card-neon rounded-2xl p-6">
                        <h2 class="text-2xl font-bold mb-6 text-white">üéØ Objetivos de Ahorro</h2>
                        
                        ${state.objetivosAhorro.length > 0 ? `
                            <div class="space-y-4 mb-6">
                                ${state.objetivosAhorro.map(objetivo => {
                                    const progreso = (parseFloat(objetivo.montoAhorrado || 0) / parseFloat(objetivo.metaMonto)) * 100;
                                    const fechaLimite = new Date(objetivo.fechaLimite);
                                    const diasRestantes = Math.ceil((fechaLimite - new Date()) / (1000 * 60 * 60 * 24));
                                    
                                    return `
                                        <div class="bg-black/30 rounded-xl p-6">
                                            <div class="flex justify-between items-start mb-4">
                                                <div class="flex-1">
                                                    <h3 class="text-white font-bold text-lg mb-1">${objetivo.nombre}</h3>
                                                    <p class="text-gray-400 text-sm">Fecha l√≠mite: ${fechaLimite.toLocaleDateString('es-ES')} (${diasRestantes} d√≠as)</p>
                                                </div>
                                                <button 
                                                    onclick="eliminarObjetivo(${objetivo.id})"
                                                    class="text-red-500 hover:text-red-400 transition-colors"
                                                >
                                                    ‚ùå
                                                </button>
                                            </div>
                                            
                                            <div class="mb-3">
                                                <div class="flex justify-between text-sm mb-2">
                                                    <span class="text-gray-400">Progreso: ${progreso.toFixed(1)}%</span>
                                                    <span class="text-white font-semibold">${parseFloat(objetivo.montoAhorrado || 0).toFixed(2)}‚Ç¨ / ${parseFloat(objetivo.metaMonto).toFixed(2)}‚Ç¨</span>
                                                </div>
                                                <div class="w-full bg-gray-700 rounded-full h-3">
                                                    <div 
                                                        class="h-3 rounded-full transition-all duration-500"
                                                        style="width: ${Math.min(progreso, 100)}%; background: linear-gradient(90deg, #8338EC, #FF006E);"
                                                    ></div>
                                                </div>
                                            </div>
                                            
                                            <div class="flex gap-2">
                                                <input 
                                                    type="number"
                                                    class="input-neon flex-1 px-4 py-2 rounded-xl text-white"
                                                    placeholder="A√±adir ahorro"
                                                    id="ahorro-${objetivo.id}"
                                                />
                                                <button 
                                                    onclick="
                                                        const input = document.getElementById('ahorro-${objetivo.id}');
                                                        const monto = parseFloat(input.value || 0);
                                                        if (monto > 0) {
                                                            const objetivo = state.objetivosAhorro.find(o => o.id === ${objetivo.id});
                                                            objetivo.montoAhorrado = (parseFloat(objetivo.montoAhorrado || 0) + monto).toString();
                                                            guardarEstado();
                                                            render();
                                                        }
                                                    "
                                                    class="btn-neon bg-green-600 px-6 py-2 rounded-xl font-bold"
                                                >
                                                    üí∞ A√±adir
                                                </button>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        ` : '<p class="text-gray-400 text-center py-4 mb-6">No hay objetivos de ahorro definidos</p>'}

                        <h3 class="text-xl font-bold mb-4 text-white">‚ûï Nuevo Objetivo</h3>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <input 
                                type="text"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Nombre del objetivo"
                                value="${state.nuevoObjetivo.nombre}"
                                oninput="state.nuevoObjetivo.nombre = this.value"
                            />
                            <input 
                                type="number"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                placeholder="Meta (‚Ç¨)"
                                value="${state.nuevoObjetivo.metaMonto}"
                                oninput="state.nuevoObjetivo.metaMonto = this.value"
                            />
                            <input 
                                type="date"
                                class="input-neon px-4 py-3 rounded-xl text-white"
                                value="${state.nuevoObjetivo.fechaLimite}"
                                oninput="state.nuevoObjetivo.fechaLimite = this.value"
                            />
                            <button 
                                onclick="agregarObjetivo()"
                                class="btn-neon bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-3 rounded-xl font-bold"
                            >
                                üéØ Crear Objetivo
                            </button>
                        </div>
                    </div>
                `;
            }
            // Vista de Categor√≠as
            else if (state.vista === 'categorias') {
                html += `
                    <div class="card-neon rounded-2xl p-6">
                        <h2 class="text-2xl font-bold mb-6 text-white">üìÅ Gesti√≥n de Categor√≠as</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                            ${state.categorias.map(categoria => `
                                <div class="bg-black/30 rounded-xl p-4 flex justify-between items-center">
                                    <div class="flex items-center gap-3">
                                        <div 
                                            class="w-4 h-4 rounded"
                                            style="background-color: ${obtenerColorCategoria(categoria)}"
                                        ></div>
                                        <span class="text-white font-semibold">${categoria}</span>
                                    </div>
                                    ${state.categorias.length > 1 ? `
                                        <button 
                                            onclick="eliminarCategoria('${categoria}')"
                                            class="text-red-500 hover:text-red-400 transition-colors"
                                        >
                                            ‚ùå
                                        </button>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>

                        <div class="flex gap-4">
                            <input 
                                type="text"
                                class="input-neon flex-1 px-4 py-3 rounded-xl text-white"
                                placeholder="Nueva categor√≠a"
                                value="${state.nuevaCategoria}"
                                oninput="state.nuevaCategoria = this.value"
                            />
                            <button 
                                onclick="agregarCategoria()"
                                class="btn-neon bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-3 rounded-xl font-bold"
                            >
                                ‚ûï Agregar Categor√≠a
                            </button>
                        </div>
                    </div>
                `;
            }
            // Vista de Perfiles
            else if (state.vista === 'perfiles') {
                html += `
                    <div class="card-neon rounded-2xl p-6">
                        <h2 class="text-2xl font-bold mb-6 text-white">üë§ Gesti√≥n de Perfiles</h2>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                            ${state.perfiles.map(perfil => `
                                <div class="bg-black/30 rounded-xl p-4 ${perfil.id === state.perfilActivo ? 'border-2 border-purple-500' : ''}">
                                    <div class="flex justify-between items-center mb-2">
                                        <span class="text-white font-semibold">${perfil.nombre}</span>
                                        ${state.perfiles.length > 1 && perfil.id !== state.perfilActivo ? `
                                            <button 
                                                onclick="eliminarPerfil(${perfil.id})"
                                                class="text-red-500 hover:text-red-400 transition-colors"
                                            >
                                                ‚ùå
                                            </button>
                                        ` : ''}
                                    </div>
                                    ${perfil.id !== state.perfilActivo ? `
                                        <button 
                                            onclick="cambiarPerfilActivo(${perfil.id})"
                                            class="btn-neon w-full bg-purple-600 px-4 py-2 rounded-xl font-bold text-sm"
                                        >
                                            Activar
                                        </button>
                                    ` : '<p class="text-green-400 text-sm font-semibold">‚úì Perfil Activo</p>'}
                                </div>
                            `).join('')}
                        </div>

                        <div class="flex gap-4">
                            <input 
                                type="text"
                                class="input-neon flex-1 px-4 py-3 rounded-xl text-white"
                                placeholder="Nombre del nuevo perfil"
                                value="${state.nuevoPerfil}"
                                oninput="state.nuevoPerfil = this.value"
                            />
                            <button 
                                onclick="agregarPerfil()"
                                class="btn-neon bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-3 rounded-xl font-bold"
                            >
                                ‚ûï Crear Perfil
                            </button>
                        </div>
                    </div>
                `;
            }
            // Vista de Configuraci√≥n
            else if (state.vista === 'configuracion') {
                html += `
                    <div class="space-y-6">
                        <!-- Configuraci√≥n de Alertas -->
                        <div class="card-neon rounded-2xl p-6">
                            <h2 class="text-2xl font-bold mb-6 text-white">üîî Configuraci√≥n de Alertas</h2>
                            
                            <div class="space-y-4">
                                <div>
                                    <label class="text-gray-300 block mb-2 font-semibold">D√≠as antes de cobro para alertar</label>
                                    <input 
                                        type="number"
                                        min="0"
                                        class="input-neon w-full px-4 py-3 rounded-xl text-white"
                                        value="${state.alertasConfig.diasParaCobro}"
                                        oninput="state.alertasConfig.diasParaCobro = parseInt(this.value); guardarEstado(); verificarAlertas(); render();"
                                    />
                                </div>
                                
                                <div>
                                    <label class="text-gray-300 block mb-2 font-semibold">Gasto m√°ximo por d√≠a (‚Ç¨)</label>
                                    <input 
                                        type="number"
                                        min="0"
                                        class="input-neon w-full px-4 py-3 rounded-xl text-white"
                                        value="${state.alertasConfig.gastoMaximoDia}"
                                        oninput="state.alertasConfig.gastoMaximoDia = parseInt(this.value); guardarEstado(); verificarAlertas(); render();"
                                    />
                                </div>
                            </div>
                        </div>

                        <!-- Gesti√≥n de Cuentas -->
                        <div class="card-neon rounded-2xl p-6">
                            <h2 class="text-2xl font-bold mb-6 text-white">üí≥ Gesti√≥n de Cuentas</h2>
                            
                            ${state.cuentas.length > 0 ? `
                                <div class="space-y-3 mb-6">
                                    ${state.cuentas.map(cuenta => `
                                        <div class="bg-black/30 rounded-xl p-4 flex justify-between items-center">
                                            <div>
                                                <p class="text-white font-semibold">${cuenta.nombre}</p>
                                                <p class="text-gray-400 text-sm">${cuenta.tipo === 'banco' ? 'üè¶ Banco' : cuenta.tipo === 'efectivo' ? 'üíµ Efectivo' : 'üí≥ Tarjeta'}</p>
                                            </div>
                                            <div class="flex items-center gap-4">
                                                <span class="text-white font-bold">${parseFloat(cuenta.saldoInicial).toFixed(2)}‚Ç¨</span>
                                                ${state.cuentas.length > 1 ? `
                                                    <button 
                                                        onclick="eliminarCuenta(${cuenta.id})"
                                                        class="text-red-500 hover:text-red-400 transition-colors"
                                                    >
                                                        ‚ùå
                                                    </button>
                                                ` : ''}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}

                            <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <input 
                                    type="text"
                                    class="input-neon px-4 py-3 rounded-xl text-white"
                                    placeholder="Nombre de la cuenta"
                                    value="${state.nuevaCuenta.nombre}"
                                    oninput="state.nuevaCuenta.nombre = this.value"
                                />
                                <select 
                                    class="input-neon px-4 py-3 rounded-xl text-white"
                                    onchange="state.nuevaCuenta.tipo = this.value"
                                >
                                    <option value="banco" ${state.nuevaCuenta.tipo === 'banco' ? 'selected' : ''}>üè¶ Banco</option>
                                    <option value="efectivo" ${state.nuevaCuenta.tipo === 'efectivo' ? 'selected' : ''}>üíµ Efectivo</option>
                                    <option value="tarjeta" ${state.nuevaCuenta.tipo === 'tarjeta' ? 'selected' : ''}>üí≥ Tarjeta</option>
                                </select>
                                <input 
                                    type="number"
                                    class="input-neon px-4 py-3 rounded-xl text-white"
                                    placeholder="Saldo inicial"
                                    value="${state.nuevaCuenta.saldoInicial}"
                                    oninput="state.nuevaCuenta.saldoInicial = this.value"
                                />
                                <button 
                                    onclick="agregarCuenta()"
                                    class="btn-neon bg-gradient-to-r from-purple-600 to-pink-600 px-6 py-3 rounded-xl font-bold"
                                >
                                    ‚ûï Agregar Cuenta
                                </button>
                            </div>
                        </div>

                        <!-- Exportar/Importar Datos -->
                        <div class="card-neon rounded-2xl p-6">
                            <h2 class="text-2xl font-bold mb-6 text-white">üíæ Datos</h2>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <button 
                                    onclick="
                                        const data = {
                                            sueldo: state.sueldo,
                                            diaCobro: state.diaCobro,
                                            gastosFijos: state.gastosFijos,
                                            gastos: state.gastos,
                                            ingresos: state.ingresos,
                                            ajustes: state.ajustes,
                                            objetivosAhorro: state.objetivosAhorro,
                                            categorias: state.categorias,
                                            perfiles: state.perfiles,
                                            alertasConfig: state.alertasConfig,
                                            cuentas: state.cuentas
                                        };
                                        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                                        const url = URL.createObjectURL(blob);
                                        const a = document.createElement('a');
                                        a.href = url;
                                        a.download = 'cartinhos-backup-' + new Date().toISOString().slice(0, 10) + '.json';
                                        a.click();
                                    "
                                    class="btn-neon bg-green-600 px-6 py-3 rounded-xl font-bold"
                                >
                                    üì• Exportar Datos
                                </button>
                                
                                <button 
                                    onclick="
                                        const input = document.createElement('input');
                                        input.type = 'file';
                                        input.accept = '.json';
                                        input.onchange = e => {
                                            const file = e.target.files[0];
                                            const reader = new FileReader();
                                            reader.onload = event => {
                                                try {
                                                    const data = JSON.parse(event.target.result);
                                                    Object.assign(state, data);
                                                    guardarEstado();
                                                    render();
                                                    alert('Datos importados correctamente');
                                                } catch (error) {
                                                    alert('Error al importar datos: ' + error.message);
                                                }
                                            };
                                            reader.readAsText(file);
                                        };
                                        input.click();
                                    "
                                    class="btn-neon bg-blue-600 px-6 py-3 rounded-xl font-bold"
                                >
                                    üì§ Importar Datos
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            html += `</div>`;
            app.innerHTML = html;

            // Inicializar iconos de Lucide
            if (typeof lucide !== 'undefined') {
                lucide.createIcons();
            }

            // Crear gr√°ficos si estamos en la vista de estad√≠sticas
            if (state.vista === 'estadisticas') {
                setTimeout(() => {
                    const datosGrafico = obtenerDatosGraficoPorMes(state.mesSeleccionado);
                    if (datosGrafico.length > 0) {
                        // Gr√°fico de pastel
                        const pieCtx = document.getElementById('pieChart');
                        if (pieCtx) {
                            new Chart(pieCtx, {
                                type: 'pie',
                                data: {
                                    labels: datosGrafico.map(d => d.nombre),
                                    datasets: [{
                                        data: datosGrafico.map(d => d.valor),
                                        backgroundColor: datosGrafico.map(d => obtenerColorCategoria(d.nombre)),
                                        borderWidth: 2,
                                        borderColor: '#0f0f23'
                                    }]
                                },
                                options: {
                                    responsive: true,
                                    maintainAspectRatio: true,
                                    plugins: {
                                        legend: {
                                            position: 'bottom',
                                            labels: {
                                                color: '#ffffff',
                                                padding: 15,
                                                font: {
                                                    size: 12
                                                }
                                            }
                                        },
                                        tooltip: {
                                            callbacks: {
                                                label: function(context) {
                                                    return context.label + ': ' + context.parsed.toFixed(2) + '‚Ç¨';
                                                }
                                            }
                                        }
                                    }
                                }
                            });
                        }
                    }

                    // Gr√°fico de barras
                    const dashboard = obtenerEstadisticasDashboard();
                    const barCtx = document.getElementById('barChart');
                    if (barCtx) {
                        new Chart(barCtx, {
                            type: 'bar',
                            data: {
                                labels: dashboard.datosBarras.map(d => d.mes),
                                datasets: [
                                    {
                                        label: 'Ingresos',
                                        data: dashboard.datosBarras.map(d => d.ingresos),
                                        backgroundColor: '#FFBE0B',
                                        borderWidth: 0
                                    },
                                    {
                                        label: 'Gastos',
                                        data: dashboard.datosBarras.map(d => d.gastos),
                                        backgroundColor: '#FF006E',
                                        borderWidth: 0
                                    }
                                ]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                scales: {
                                    y: {
                                        beginAtZero: true,
                                        ticks: {
                                            color: '#9CA3AF',
                                            callback: function(value) {
                                                return value + '‚Ç¨';
                                            }
                                        },
                                        grid: {
                                            color: 'rgba(131, 56, 236, 0.2)'
                                        }
                                    },
                                    x: {
                                        ticks: {
                                            color: '#9CA3AF'
                                        },
                                        grid: {
                                            display: false
                                        }
                                    }
                                },
                                plugins: {
                                    legend: {
                                        labels: {
                                            color: '#ffffff',
                                            padding: 15
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                return context.dataset.label + ': ' + context.parsed.y.toFixed(2) + '‚Ç¨';
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }, 100);
            }
        }

        // Renderizar la aplicaci√≥n inicialmente
        render();
    </script>
</body>
</html>